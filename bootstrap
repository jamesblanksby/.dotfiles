#!/usr/bin/env bash

function execute() {
    echo "‚öôÔ∏è  Setting up a $SETUP system configuration:"

    # Initialise profile
    source "$HOME/.bash_profile"

    divider

    # Bootstrap global scripts
    for file in ./script/*; do
        [ -f "$file" ] && source "$file"
    done

    # Bootstrap setup scripts
    for file in ./script/$SETUP/*; do 
        [ -f "$file" ] && source "$file"
    done

    # Success message
    echo "‚úÖ Bootstrapping complete"
}

function divider() {
    printf "%*s\n" "${COLUMNS:-$(tput cols)}" "" | tr " " -
}

# Ask for the administrator password upfront
sudo -v

# Update existing sudo timestamp until bootstrap has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

divider

# Choose setup type
echo "üõ†Ô∏è  What kind of setup do you want to create?"
echo "1. Personal (default)"
echo "2. Developer"
read -p "Option: " SETUP

# Validate setup type
case $SETUP in
    1) SETUP="personal" ;;
    2) SETUP="developer" ;;
    *) SETUP="personal" ;;
esac

divider

# Overwrite file warning
echo "‚ö†Ô∏è  This will overwrite existing files in your home directory."
read -p "Are you sure? (y/n): "

divider

# Validate positive reply
if [[ $REPLY =~ ^[Yy]$ ]]; then
    execute
fi

exit
